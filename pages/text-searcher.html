<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>文本搜索功能 - 咪啪工具集</title>
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Font Awesome -->
    <link href="https://cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css" rel="stylesheet">
    <!-- FileSaver.js -->
    <script src="https://cdn.jsdelivr.net/npm/file-saver@2.0.5/dist/FileSaver.min.js"></script>
    <!-- 引入Inter字体 -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    
    <!-- 自定义配置 -->
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#165DFF',
                        secondary: '#6C757D',
                        success: '#28A745',
                        danger: '#DC3545',
                        warning: '#FFC107',
                        info: '#17A2B8',
                    },
                    fontFamily: {
                        sans: ['Inter', 'system-ui', 'sans-serif'],
                    },
                }
            }
        }
    </script>
    <style type="text/tailwindcss">
        @layer utilities {
            .content-auto {
                content-visibility: auto;
            }
            .file-item-hover:hover {
                @apply bg-gray-50;
            }
            .text-highlight {
                @apply bg-yellow-200 px-0.5 rounded font-semibold;
            }
            .card {
                transition: transform 0.2s ease, box-shadow 0.2s ease;
            }
            .card:hover {
                @apply transform -translate-y-1 shadow-lg;
            }
            .btn {
                transition: all 0.2s ease;
            }
            .btn:hover {
                @apply transform -translate-y-0.5;
            }
            .btn:active {
                @apply transform translate-y-0;
            }
        }
    </style>
</head>
<body class="bg-gray-50 min-h-screen flex flex-col">
    <header class="bg-gradient-to-r from-primary to-blue-700 text-white shadow-lg">
        <div class="container mx-auto px-4 sm:px-6 py-4 sm:py-6 flex flex-col md:flex-row justify-between items-center">
            <a href="../index.html" class="text-2xl sm:text-3xl font-bold mb-4 md:mb-0 tracking-tight hover:text-blue-200 transition-all">
                <i class="fa fa-wrench mr-2"></i>咪啪工具集
            </a>
            <!-- 导航栏简化，只保留标题返回首页功能 -->
        </div>
    </header>

    <main class="container mx-auto px-4 sm:px-6 py-8 sm:py-12 flex-grow">
        <!-- 文本文件处理部分 -->
        <section class="bg-white rounded-xl shadow-md p-4 sm:p-6 mb-8 sm:mb-12 card">
            <h2 class="text-xl sm:text-3xl font-bold mb-4 sm:mb-6 flex items-center text-gray-800">
                <i class="fa fa-file-text-o mr-3 text-primary text-2xl"></i>文本搜索
            </h2>
            
            <!-- 输入方式选择 -->
            <div class="mb-6">
                <div class="flex flex-wrap gap-3 mb-4">
                    <button id="textPasteInputTab" class="px-4 py-2 bg-primary text-white rounded-l-lg hover:bg-primary/90 transition-colors btn whitespace-nowrap">
                        <i class="fa fa-paste mr-2"></i>文本粘贴
                    </button>
                    <button id="textFileInputTab" class="px-4 py-2 bg-gray-200 text-gray-700 rounded-r-lg hover:bg-gray-300 transition-colors btn whitespace-nowrap">
                        <i class="fa fa-file-o mr-2"></i>文件上传
                    </button>
                </div>
            </div>

            <!-- 上传文件区域 -->
            <div id="textFileInputSection" class="mb-4 sm:mb-2">
                <label class="block text-gray-700 font-medium mb-2 sm:mb-3 text-sm sm:text-lg">选择文本文件（支持多选）</label>
                <div class="flex flex-col sm:flex-row items-stretch sm:items-center gap-4 mb-3">
                    <div class="flex-1">
                        <input type="file" id="textFileUpload" accept=".txt,.log,.json,.xml,.html,.js,.css,.md" multiple
                            class="block w-full text-sm text-gray-500
                            file:mr-4 file:py-2 file:px-4
                            file:rounded-lg file:border-0
                            file:text-sm file:font-medium
                            file:bg-primary/10 file:text-primary
                            hover:file:bg-primary/20 focus:outline-none focus:ring-2 focus:ring-primary/20 focus:border-primary" />
                    </div>
                    <button id="clearTextFilesBtn" class="px-4 py-2 bg-gray-200 text-gray-700 text-sm rounded-lg hover:bg-gray-300 transition-colors hidden btn flex items-center justify-center whitespace-nowrap">
                        <i class="fa fa-refresh mr-2"></i>清空
                    </button>
                </div>
                <div id="textFilesInfo" class="hidden p-3 bg-blue-50 rounded-lg border border-blue-100 mt-3 flex items-center font-medium">
                    <i class="fa fa-info-circle text-primary mr-2"></i>
                </div>
            </div>

            <!-- 文本粘贴区域 -->
            <div id="textPasteInputSection" class="mb-4 sm:mb-2 hidden">
                <label class="block text-gray-700 font-medium mb-2 sm:mb-3 text-sm sm:text-lg">粘贴文本内容</label>
                <div class="mb-3 relative">
                    <!-- 行号显示区域 -->
                    <div id="textDirectInputLineNumbers" style="border-right-style: dashed !important;" class="absolute left-0 top-0 bottom-0 w-12 bg-gray-50 border-t-[1px] border-l-[1px] border-b-[1px] border-r-[1px] border-t-solid border-l-solid border-b-solid border-r-dashed border-gray-300 rounded-l-lg flex flex-col items-end justify-start py-3 px-2 text-gray-400 font-mono text-sm overflow-hidden pointer-events-none"></div>
                    <!-- 文本输入区域 -->
                    <div class="relative">
                        <textarea id="textDirectInput" placeholder="请在此粘贴要搜索的文本内容..." rows="10"
                            class="w-full pl-16 pr-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary/20 focus:border-primary outline-none font-mono text-sm resize-none whitespace-nowrap overflow-x-auto overflow-y-auto min-h-[300px] max-h-[500px] absolute inset-0 bg-transparent z-10"></textarea>
                        <div class="w-full pl-16 pr-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary/20 focus:border-primary outline-none font-mono text-sm resize-none whitespace-nowrap overflow-x-auto overflow-y-auto min-h-[300px] max-h-[500px] pointer-events-none"></div>
                    </div>
                </div>

            </div>

            <!-- 搜索框 -->
            <div id="searchContainer" class="mb-4 sm:mb-8 hidden">
                <label class="block text-gray-700 font-medium mb-2 sm:mb-3 text-sm sm:text-lg">搜索内容</label>
                
                <div class="flex flex-wrap items-center gap-3 mb-3">
                    <input type="text" id="regexSearchInput" placeholder="输入搜索关键词或正则表达式" 
                        class="flex-1 min-w-[200px] px-4 py-3 border border-gray-300 rounded-l-lg focus:ring-2 focus:ring-primary/20 focus:border-primary outline-none" />
                    <button id="regexSearchBtn" class="px-6 py-3 bg-primary text-white rounded-r-lg hover:bg-primary/90 transition-colors btn whitespace-nowrap">
                        <i class="fa fa-search mr-2"></i>搜索
                    </button>
                </div>
                <!-- 搜索选项移到搜索内容正下方 -->
                <div class="flex flex-wrap gap-4 mb-4 sm:mb-6">
                    <div class="flex items-center gap-2 p-3 bg-gray-50 rounded-lg">
                        <input type="checkbox" id="caseSensitive" 
                            class="w-4 h-4 text-primary border-gray-300 rounded focus:ring-primary" />
                        <label for="caseSensitive" class="text-sm sm:text-base text-gray-700 font-medium">区分大小写</label>
                    </div>
                    <div class="flex items-center gap-2 p-3 bg-gray-50 rounded-lg">
                        <input type="checkbox" id="regexSearch" 
                            class="w-4 h-4 text-primary border-gray-300 rounded focus:ring-primary" />
                        <label for="regexSearch" class="text-sm sm:text-base text-gray-700 font-medium">正则搜索</label>
                    </div>
                    <div class="flex items-center gap-2 p-3 bg-gray-50 rounded-lg" id="fullTextSearchContainer" style="display: none;">
                        <input type="checkbox" id="fullTextSearch" 
                            class="w-4 h-4 text-primary border-gray-300 rounded focus:ring-primary" />
                        <label for="fullTextSearch" class="text-sm sm:text-base text-gray-700 font-medium">全文搜索</label>
                    </div>
                </div>
                <div id="regexSearchLoading" class="hidden p-3 rounded-lg border border-primary/20 bg-primary/5 mb-3 flex items-center font-medium">
                    <div class="animate-spin rounded-full h-5 w-5 border-2 border-gray-200 border-t-primary mr-3"></div>
                    <span class="text-sm text-primary">搜索中...</span>
                </div>
            
            <!-- 正则表达式语法提示 -->
            <div class="mt-4">
                <div class="flex items-center justify-between cursor-pointer" id="regexHelpToggle">
                    <h4 class="text-sm font-medium text-gray-700">
                        <i class="fa fa-question-circle mr-2 text-primary"></i>正则表达式语法提示
                    </h4>
                    <i class="fa fa-chevron-down transition-transform duration-200 text-gray-500"></i>
                </div>
                <div id="regexHelpContent" class="hidden mt-2 p-4 bg-white border border-gray-200 rounded-lg shadow-sm">
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div>
                            <h5 class="text-xs font-semibold text-gray-600 mb-2">常用语法</h5>
                            <ul class="text-xs text-gray-700 space-y-1">
                                <li><code>.</code> - 匹配任意单个字符</li>
                                <li><code>*</code> - 匹配前面的字符0次或多次</li>
                                <li><code>+</code> - 匹配前面的字符1次或多次</li>
                                <li><code>?</code> - 匹配前面的字符0次或1次</li>
                                <li><code>^</code> - 匹配字符串开头</li>
                                <li><code>$</code> - 匹配字符串结尾</li>
                                <li><code>\d</code> - 匹配任意数字</li>
                                <li><code>\w</code> - 匹配任意字母、数字或下划线</li>
                                <li><code>\s</code> - 匹配任意空白字符</li>
                            </ul>
                        </div>
                        <div>
                            <h5 class="text-xs font-semibold text-gray-600 mb-2">高级语法</h5>
                            <ul class="text-xs text-gray-700 space-y-1">
                                <li><code>[abc]</code> - 匹配方括号内的任意字符</li>
                                <li><code>[^abc]</code> - 匹配除方括号内字符外的任意字符</li>
                                <li><code>a|b</code> - 匹配a或b</li>
                                <li><code>(abc)</code> - 捕获组，匹配括号内的内容</li>
                                <li><code>{n}</code> - 匹配前面的字符n次</li>
                                <li><code>{n,}</code> - 匹配前面的字符至少n次</li>
                                <li><code>{n,m}</code> - 匹配前面的字符n到m次</li>
                                <li><code>\b</code> - 匹配单词边界</li>
                            </ul>
                        </div>
                    </div>
                    <div class="mt-3 pt-3 border-t border-gray-200">
                        <h5 class="text-xs font-semibold text-gray-600 mb-2">示例</h5>
                        <ul class="text-xs text-gray-700 space-y-1">
                            <li><code>error\s+\d{3}</code> - 匹配"error 404"、"error 500"等</li>
                            <li><code>^\d{4}-\d{2}-\d{2}</code> - 匹配日期格式如"2023-12-31"</li>
                            <li><code>https?:\/\/[^\s]+</code> - 匹配HTTP或HTTPS URL</li>
                        </ul>
                    </div>
                </div>
            </div>
            </div>

            <!-- 搜索提示信息 -->
            <div id="searchValidationInfo" class="hidden p-3 rounded-lg border mb-3 flex items-center font-medium">
                <i id="searchValidationIcon" class="fa mr-2"></i>
                <span id="searchValidationText" class="text-sm text-base"></span>
            </div>
            
            <!-- 搜索结果 -->
            <div id="searchResults" class="hidden mb-6">
                <div class="flex flex-col sm:flex-row sm:justify-between sm:items-center mb-4 gap-3">
                    <h3 class="font-medium text-gray-700 text-lg">搜索结果 <span class="text-sm text-gray-500">(共匹配 <span id="matchCount">0</span> 项)</span></h3>
                    <div class="flex flex-wrap gap-3 justify-start sm:justify-end">
                        <button id="copyResultsBtn" class="px-4 py-2 bg-info text-white rounded-lg hover:bg-info/90 transition-colors btn whitespace-nowrap text-sm">
                            <i class="fa fa-copy mr-2"></i>复制
                        </button>
                        <button id="exportResultsBtn" class="px-4 py-2 bg-success text-white rounded-lg hover:bg-success/90 transition-colors btn whitespace-nowrap text-sm">
                            <i class="fa fa-download mr-2"></i>下载
                        </button>
                    </div>
                </div>
                <div id="resultList" class="max-h-[500px] overflow-y-auto border border-gray-200 rounded-lg divide-y divide-gray-100 bg-gray-50 p-2">
                    <!-- 搜索结果将动态生成 -->
                </div>
            </div>
        </section>
    </main>

    <footer class="bg-gradient-to-r from-gray-800 to-gray-900 text-white py-6 sm:py-8">
        <div class="container mx-auto px-4 sm:px-6 text-center">
            <p class="text-sm sm:text-lg font-medium">Log分析工具 - 专注于高效的日志文件处理和搜索</p>
            <p class="mt-3 text-xs sm:text-base text-gray-300">使用 <i class="fa fa-heart text-danger"></i> 构建</p>
        </div>
    </footer>


    <!-- 引入JavaScript模块 -->
    <script src="../js/text-searcher.js"></script>
</body>
</html>